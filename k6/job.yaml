apiVersion: batch/v1
kind: Job
metadata:
  name: k6
  namespace: k6
spec:
  backoffLimit: 4
  ttlSecondsAfterFinished: 600
  template:
    spec:
      containers:
      - name: k6
        args:
        - "run"
        - "--duration"
        - "60s"
        - "--vus"
        - "20000"
        - "/opt/k6/script.js"
        image: loadimpact/k6
        imagePullPolicy: Always
        volumeMounts:
        - mountPath: /tmpfs
          name: tempfs
        - name: script
          mountPath: /opt/k6/
      restartPolicy: Never
      volumes:
      - emptyDir:
          medium: Memory
        name: tempfs
      - name: script
        projected:
          sources:
            - configMap:
                name: script
